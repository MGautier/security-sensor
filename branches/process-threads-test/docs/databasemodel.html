<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>databasemodel.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>databasemodel.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">sqlite3</span> <span class="kn">as</span> <span class="nn">db</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">columnsdatabase</span> <span class="kn">import</span> <span class="n">ColumnsDatabase</span>
<span class="kn">from</span> <span class="nn">rowsdatabase</span> <span class="kn">import</span> <span class="n">RowsDatabase</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>Clase para la manipulacion de la base de datos. Será cómo un modelo en MVC, en dónde
nos olvidamos de la capa de datos y simplemente operamos con ellos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">DatabaseModel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Crea una base de datos con el nombre db_name. Si no existe, la crea.
Por defecto crea las tablas especificadas para el proyecto.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_name</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_name</span> <span class="o">+</span><span class="s">&#39;.db&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;pragma foreign_keys=ON&#39;&#39;&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;create table if not exists ips</span>
<span class="s">            (ID_IP INTEGER PRIMARY KEY, Hostname VARCHAR(60),</span>
<span class="s">            Tag VARCHAR(255))&#39;&#39;&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;create table if not exists ports</span>
<span class="s">            (ID_PORT INTEGER PRIMARY KEY, Service VARCHAR(60),</span>
<span class="s">            Tag VARCHAR(255))&#39;&#39;&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;create table if not exists sources</span>
<span class="s">            (ID_sources VARCHAR(70) PRIMARY KEY, Description TEXT, Type VARCHAR(100),</span>
<span class="s">            Model VARCHAR(255), Active TINYINT, Software_class VARCHAR(50),</span>
<span class="s">            Path VARCHAR(20))&#39;&#39;&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;create table if not exists process</span>
<span class="s">            (ID_process INTEGER PRIMARY KEY ASC, Info_1 VARCHAR(255),</span>
<span class="s">            Info_2 VARCHAR(255), Info_3 VARCHAR(255), Info_4 VARCHAR(255),</span>
<span class="s">            Info_5 VARCHAR(255), Info_6 VARCHAR(255), Info_7 VARCHAR(255),</span>
<span class="s">            Info_8 VARCHAR(255), Info_9 VARCHAR(255), Info_10 VARCHAR(255))&#39;&#39;&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;create table if not exists events</span>
<span class="s">            (ID_events INTEGER PRIMARY KEY ASC, Timestamp DATETIME,</span>
<span class="s">            S_IP VARCHAR(60), D_IP VARCHAR(60), S_PORT INTEGER,</span>
<span class="s">            D_PORT INTEGER, Protocol CHARACTER(20), S_MAC VARCHAR(17),</span>
<span class="s">            D_MAC VARCHAR(17), IP_ID VARCHAR(70),</span>
<span class="s">            Info_RAW TEXT, Info_Proc INTEGER, TAG VARCHAR(255),</span>
<span class="s">            FOREIGN KEY(S_IP) REFERENCES ips(ID_IP),</span>
<span class="s">            FOREIGN KEY(D_IP) REFERENCES ips(ID_IP),</span>
<span class="s">            FOREIGN KEY(S_PORT) REFERENCES ports(ID_PORT),</span>
<span class="s">            FOREIGN KEY(D_PORT) REFERENCES ports(ID_PORT),</span>
<span class="s">            FOREIGN KEY(IP_ID) REFERENCES sources(ID_sources),</span>
<span class="s">            FOREIGN KEY(Info_Proc) REFERENCES process(ID_process))&#39;&#39;&#39;</span><span class="p">)</span>

            <span class="k">print</span> <span class="s">&quot;Base de datos &#39;</span><span class="si">%s</span><span class="s">&#39; creada con éxito&quot;</span> <span class="o">%</span> <span class="n">db_name</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>Crea una tabla en la base de datos instanciada por el objeto de clase.
Además, también añade las columnas necesarias en su creación.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">create_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">table_columns</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">create_query</span> <span class="o">=</span> <span class="n">table_columns</span><span class="o">.</span><span class="n">list_columns</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;create table if not exists </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">create_query</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Tabla &#39;</span><span class="si">%s</span><span class="s">&#39; creada con éxito&quot;</span> <span class="o">%</span> <span class="n">table_name</span>
        <span class="k">except</span> <span class="n">db</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;create_table :-&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>Método que permite modificar el nombre de la tabla. Si hay
eventos asociados al anterior nombre de tabla, tendrán que
redefinirse con el nuevo nombre establecido.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">alter_table_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">new_table_name</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">new_table_name</span> <span class="o">!=</span> <span class="n">table_name</span><span class="p">:</span> <span class="c">#Compruebo si se va a renombrar una tabla o no</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;alter table </span><span class="si">%s</span><span class="s"> rename to </span><span class="si">%s</span><span class="s">&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">new_table_name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="k">print</span> <span class="s">&quot;Tabla &#39;</span><span class="si">%s</span><span class="s">&#39; renombrada a &#39;</span><span class="si">%s</span><span class="s">&#39; con éxito&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">new_table_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">db</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;alter_table_name :-&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>Método que permite añadir una columna a la tabla.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">alter_table_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">add_column</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;alter table </span><span class="si">%s</span><span class="s"> add </span><span class="si">%s</span><span class="s">&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">add_column</span><span class="o">.</span><span class="n">list_columns</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Columna &#39;</span><span class="si">%s</span><span class="s">&#39; añadida a la tabla &#39;</span><span class="si">%s</span><span class="s">&#39; con éxito&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">add_column</span><span class="o">.</span><span class="n">list_columns</span><span class="p">(),</span> <span class="n">table_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">db</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;alter_table_column :-&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Método que permite eliminar una tabla de la base de datos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">drop_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;drop table if exists </span><span class="si">%s</span><span class="s">&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Tabla &#39;</span><span class="si">%s</span><span class="s">&#39; eliminada con éxito&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">db</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;drop_table :-&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Método que permite listar todas las tablas de la base de datos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">list_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select name from sqlite_master where type = &#39;table&#39;&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">aux_string</span> <span class="o">=</span> <span class="s">&quot;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">aux_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;(u&#39;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;,)&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">))</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span>
        <span class="k">except</span> <span class="n">db</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;list_tables :-&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>Método que nos permite visualizar la información de la tabla que queramos</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">info_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;pragma table_info(&#39;</span><span class="si">%s</span><span class="s">&#39;)&quot;</span> <span class="o">%</span> <span class="n">table_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">record</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="bp">self</span><span class="o">.</span><span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span>
        <span class="k">except</span> <span class="n">db</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;info_tables :-&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>Método para introducir valores en nuestra tabla de la base de datos.
Ejemplo: INSERT INTO table_name VALUES(values)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">insert_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">rows_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_columns_insert</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span><span class="n">values</span><span class="o">.</span><span class="n">get_rows</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size_insert</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows_value</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">size_table</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size_table</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">size_insert</span> <span class="o">+=</span> <span class="s">&quot;?, &quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">size_insert</span> <span class="o">+=</span> <span class="s">&quot;?&quot;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">size_table</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">size_insert</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">((</span><span class="s">&quot;insert or replace into &quot;</span> <span class="o">+</span> <span class="n">table_name</span> <span class="o">+</span> <span class="s">&quot; values(&quot;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">size_insert</span> <span class="o">+</span><span class="s">&quot; )&quot;</span><span class="p">),</span>  <span class="bp">self</span><span class="o">.</span><span class="n">rows_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Valores introducidos en la tabla </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">table_name</span>
        <span class="k">except</span> <span class="n">db</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;insert_row :-&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>Método para eliminar una fila de datos de una tabla.
Ejemplo: DELETE FROM table_name WHERE column_id = row_value</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">delete_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">column_id</span><span class="p">,</span> <span class="n">row_value</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;delete from </span><span class="si">%s</span><span class="s"> where </span><span class="si">%s</span><span class="s"> = &#39;</span><span class="si">%s</span><span class="s">&#39; &#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">column_id</span><span class="p">,</span> <span class="n">row_value</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Valor </span><span class="si">%s</span><span class="s"> = &#39;</span><span class="si">%s</span><span class="s">&#39; eliminado de la tabla </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">column_id</span><span class="p">,</span> <span class="n">row_value</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">db</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;delete_row :-&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>Método para actualizar una fila de datos de una tabla.
Ejemplo: UPDATE table_name SET column_value = row_value WHERE column_id = value_id</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">update_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">column_value</span><span class="p">,</span> <span class="n">row_value</span><span class="p">,</span> <span class="n">column_id</span><span class="p">,</span> <span class="n">value_id</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;update prueba set col4 = ? where col1 =?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">row_value</span><span class="p">,</span> <span class="n">value_id</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Valor </span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s"> del campo id </span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s"> actualizado&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">column_value</span><span class="p">,</span> <span class="n">row_value</span><span class="p">,</span> <span class="n">column_id</span><span class="p">,</span> <span class="n">value_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">db</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;update_row :-&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>Método consultor que nos devuelve el número de columnas de una tabla.
Nos es útil a la hora de crear el objeto RowsDatabase.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">num_columns_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_tables</span><span class="p">(</span><span class="n">table_name</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>Método que comprueba si el numero de columnas coincide con el
de valores a introducir en la fila de la tabla. Si hay discordancia,
introduce valores empty ' '</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">check_columns_insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">list_checked</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aux_checked</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>Si el numero de columnas es mayor al numero de valores
que vamos a introducir, introducimos valores empty ' '
por cada columna que falta</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterator</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">aux_checked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterator</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aux_checked</span><span class="o">.</span><span class="n">__len__</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">):</span>

                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">aux_checked</span><span class="o">.</span><span class="n">__len__</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">aux_checked</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">list_checked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aux_checked</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_checked</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>Método para cerrar la base de datos para más operaciones.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">close_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">bd_pfc</span> <span class="o">=</span> <span class="n">DatabaseModel</span><span class="p">(</span><span class="s">&#39;proyecto_bd&#39;</span><span class="p">)</span>
<span class="n">bd_pfc</span><span class="o">.</span><span class="n">close_db</span><span class="p">()</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
